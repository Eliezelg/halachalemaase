(()=>{var e={};e.id=120,e.ids=[120],e.modules={6330:e=>{"use strict";e.exports=require("@prisma/client")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9748:e=>{"use strict";e.exports=require("fs/promises")},3873:e=>{"use strict";e.exports=require("path")},1693:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>N,routeModule:()=>y,serverHooks:()=>E,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>j});var s={};t.r(s),t.d(s,{DELETE:()=>w,GET:()=>k,POST:()=>m,PUT:()=>x});var o=t(2706),a=t(8203),i=t(5994),n=t(9187),u=t(9748),c=t.n(u),p=t(3873),l=t.n(p),d=t(6634),g=t(97);let f=l().join(process.cwd(),"public/Sfarim");async function k(){try{let e=await d.F.getAllBooks();return n.NextResponse.json(e.map(g.zJ))}catch(e){return console.error("API Error - GET /api/books:",e),n.NextResponse.json({error:"Error reading books",details:e instanceof Error?e.message:String(e)},{status:500})}}async function m(e){try{let r=await e.formData(),t=r.get("title"),s=r.get("description"),o=r.get("price"),a=r.get("image"),i=r.get("nedarimPlusLink"),p="true"===r.get("isNew");if(!t||!s)return n.NextResponse.json({error:"Missing required fields"},{status:400});let g=null;if(a){await c().mkdir(f,{recursive:!0});let e=Date.now(),r=`${e}-${a.name}`,t=l().join(f,r),s=await a.arrayBuffer(),o=Buffer.from(s);await (0,u.writeFile)(t,o),g=`/Sfarim/${r}`}let k=await d.F.createBook({title:t,description:s,price:o,imageUrl:g,nedarimPlusLink:i,isNew:p});return n.NextResponse.json(k)}catch(e){return console.error("API Error - POST /api/books:",e),n.NextResponse.json({error:"Error creating book",details:e instanceof Error?e.message:String(e)},{status:500})}}async function x(e){try{let r;let t=await e.formData(),s=t.get("id"),o=t.get("title"),a=t.get("description"),i=t.get("price"),p=t.get("image"),k=t.get("nedarimPlusLink"),m="true"===t.get("isNew");if(!s||!o||!a)return n.NextResponse.json({error:"Missing required fields"},{status:400});if(p){await c().mkdir(f,{recursive:!0});let e=Date.now(),t=`${e}-${p.name}`,s=l().join(f,t),o=await p.arrayBuffer(),a=Buffer.from(o);await (0,u.writeFile)(s,a),r=`/Sfarim/${t}`}let x=await d.F.updateBook(s,{title:o,description:a,price:i||null,...r&&{imageUrl:r},nedarimPlusLink:k||null,isNew:m});return n.NextResponse.json((0,g.zJ)(x))}catch(e){return console.error("API Error - PUT /api/books:",e),n.NextResponse.json({error:"Error updating book",details:e instanceof Error?e.message:String(e)},{status:500})}}async function w(e){try{let{id:r}=await e.json();if(!r)return n.NextResponse.json({error:"Missing book ID"},{status:400});if(!await d.F.deleteBook(r))return n.NextResponse.json({error:"Book not found"},{status:404});return n.NextResponse.json({success:!0})}catch(e){return console.error("API Error - DELETE /api/books:",e),n.NextResponse.json({error:"Error deleting book",details:e instanceof Error?e.message:String(e)},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/books/route",pathname:"/api/books",filename:"route",bundlePath:"app/api/books/route"},resolvedPagePath:"D:\\Sites\\Halachalemaase\\halacha\\app\\api\\books\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:b,workUnitAsyncStorage:j,serverHooks:E}=y;function N(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:j})}},6487:()=>{},8335:()=>{},1587:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});var s=t(6330);let o=global.prisma||new s.PrismaClient},6634:(e,r,t)=>{"use strict";t.d(r,{F:()=>o});var s=t(1587);let o={getAllBooks:async()=>s.z.book.findMany(),getBookById:async e=>{let r=parseInt(e,10);return isNaN(r)?null:s.z.book.findUnique({where:{id:r}})},createBook:async e=>s.z.book.create({data:e}),updateBook:async(e,r)=>{let t=parseInt(e,10);return isNaN(t)?null:s.z.book.update({where:{id:t},data:r})},deleteBook:async e=>{let r=parseInt(e,10);if(isNaN(r))return!1;try{return await s.z.book.delete({where:{id:r}}),!0}catch{return!1}}}},97:(e,r,t)=>{"use strict";t.d(r,{q4:()=>s,zJ:()=>o});let s=e=>({...e,id:e.id.toString(),topics:e.topics,languages:e.languages||[]}),o=e=>({...e,id:e.id.toString()})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,452],()=>t(1693));module.exports=s})();